---
title: | 
  | \Large{Homework - Day 2: Simulation I (Observational Data)}
author: \emph{Yui Nishimura}
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document:
    highlight: tango
    latex_engine: xelatex
    number_sections: yes
    toc: yes
    toc_depth: 2
geometry: margin=1.2in
subtitle: Social Analysis and Simulation in R
fontsize: 11pt
---
  


```{r global_option, include=FALSE}
# Before start, I define options for the general outputs
library("knitr")
library("lmtest")
knitr::opts_chunk$set(warning = FALSE, echo = TRUE, message = TRUE,
                      # setting for chunk options 
                      fig.width = 5, fig.height = 4, fig.align="center")
                      # setting for figure output
```

# Simulation for A Countinuous Outcome

**Instruction**: In this question, you are asked to simulate an observational data you would want to analyze if you have all the resources and tools to complete the data collection process. First, briefly describe a research question that you are interested in, but have not empirically examined or collected any data about. Specify one continuous random variable of interest and consider the data generating process for that random variable. For example, the continuous random variable can emerge from a normal distribution (with a positive variance) whose expected value is a linear function of several independent variables.

Next, simulate N hypothetical data points for your "dependent variable" under the data generating process, where you first generate N data points for your “independent variables,” and then create the continuous variable. Here N must be determined according to your population of interest and consider that you can have a census of the population (i.e., you do not have to consider any form of sampling and just imagine that you can collect all data). During this process, focus on details and make sure that you specify the theoretical range of each variable and the simulated data follows such theoretical bound (i.e., you cannot simulate the value -30 or 120 for a variable denoting percentage). Here create at least one aggregate level variable (e.g., city level median income). Moreover, if you theorize that one or more independent variables are a function of another independent variable, incorporate the perspective into the data generating process.

Finally, provide a set of descriptive statistics of the data both numerically and visually and perform a set of Normal-Linear regression models. Output a coefficient table in LATEX format and create a plot for predicted values of the continuous variable for typical units. Be sure that such typical units must be inside the convex hull of the data, meaning that the prediction must be made for observations the combination of whose covariate values surely exists in the data. To conclude your answer, make some relevant comments on what you would have to account for when you are actually going to collect the observational data.

## Introduction -- Research Question and Background

**What types of characteristics make states ratify multirateral treaties more quickly than others?** In reality, we can observe that some countries ratify agreements very quickly after they became open to ratify, but others takes very long time. In the existing literature, scholars have tried to understand what determines duration until ratification in various cases of international agreements, by assuming that such a variety represents as the willingness of ratify of the state. However, this assumption might not be always true, if there is a systematic element affecting the ratification process at the domestic level. During negotiation process, states bargain about provisions which legally bind themselves in the future. However, once after they reach the consensus, the decision-making to ratify or not is dependent on the domestic political process. Then, for example, it possibly happens that some countries require more time to obtain administrative approval with complicated procedures and various actors, but others just require political leader's signature on a single piece of paper, even if they have a very strong preference to ratify. If so, the differences in terms of duration across countries does not necessarily mean their differences in intentions behind observed behaviors. 

Unfortunately, however, there is no assessment to reveal the general ratification pattern of each country. Accordingly, the central motivation of my research is, to identify what states characteristics have an influence on the general mechanism of ratification regardless of treaty types. 

## Domestic Political Institutions and Ratification Process

As I mentioned before, the domestic administrative process is the key element. My theoretical expectatin is that democratic countries take more time to ratify treaties. I am interested in how domestic political institutions have an influence on their duration until ratify treaties, comparing to non-democratic regime. There are two phases making ratification process delay in democratic countries. One is the legislative hurdle. Assuming office-seeking legislatures, it is possible that some of them disagree with treaties which can conflict with preferences of their supporters. Or, even if the legislatures do not disagree, they might want to prioritize discussions about domestic policies at the Congress and the Parliament. The other process required in democracies is the executive procedure. Where executive brunch have constraint on the decision making, it becomes more hard to pass potentional new laws related to treaties or to obtain approval for treaties. Comparing to this, in autocracy, decision making is done by a political lader and the small group of relevant actors. Also, leaders do not need to take accountability to citizens in terms of decisions they made and counsequences of the decisions. Accordingly, I expect that the general time to ratify takes more time in democracies, comparing to autocratic countris. 

Before getting in depth about details, I specify what are the "treaty" in this context. Although there are a number of treaty types, I am interested in international multirateral treaties, which are open for all the United Nations member countries. These treaties are differenciated by other treaties, such as bilateral treaties, since every state has the equal opportunity to participate. Regional treaties, for example, only focus on members of the reagion as potential ratifiers. Bilateral treaties are exclusive too. Considering those characteristics, the examination of  the UN treaties has an advantage to compare all UN members in terms of their overall ratifying practices. 

### Sample and Measurement

Based on the discussion above, the analytical unit is country, and all countries are the UN members. The total number of the UN members is 193. To understand the pattern, I measure it by taking a arithmetic mean of years until ratification for all treaties they follow (" _average duration_ ", hereafter), as the outcome variable. The first UN treaty became open in 1945. If states do not ratify a treaty yet, it is recognized as still being the ratification process, and the possible latest year is 2019. Therefore, the longest time to ratify treaty is 74 years (= 2019 - 1945). Since I calculate the arismetic mean, so the variable is continuous.

The key independent variable of interest is _regime type_. If countries are currently ruled in democratic political system, it is considered as democracy, otherwise autocracy. For the sake of the requrement of the question, I include the number of _regional institutions_ (RIs) as a control variable. This is because the development of RIs can embed members in the regional ties and cooperation based agreements, and peer pressure for ratification emerge. In addition, I include the _regime transition experience_ because it might affects the current ruling system and ratification process to some treaties which were done in different ways. 


$$
Y = \alpha + \beta_1 X_{regime} + \beta_2 X_{RI} + \beta_3 X_{transition} 
$$



## Simulation


### Preparation 

First, I clean up the environment.
```{r clean-up, results=FALSE}
rm(list=ls()) # rm() cleans up your R
gc();gc()     # gc() cleans up your memory
```


Here I simulate the model for the most ideal case, where the every data would be available. To fix the results for the pseudo-random number generation, I also set seed here. 
```{r simulation setup}
simN <- 193    # the number of total UN members 
```




**Regime Type**

For now, I start to create the independent variables based on substantive knowledge. First, I create the regime variable. 

```{r regime type}
set.seed(7272)
democrat <- rbinom(simN, size = 1, prob = .7)
```



```{r}
summary(democrat)
unique(democrat)

# visualization of frequency in barplot - for discrete variable
democrat_name <- ifelse(democrat == 1, "Democracy", "Autocracy")
barplot(table(democrat_name), main = "Bar plot of regime variable", 
        xlab = "Regime type", ylab = "Frequency", ylim=c(0,140), col = "maroon")
```


**Number of Regional Institutions**

Next, I create the variable of RIs. To deffirenciate the region based on this variable, I set the condition based on the general observation of treaty ratification pattern across regions. 

```{r, results='asis'}
# creating an aggregate level variable - regional institutions
set.seed(7272)
region1 <- ifelse(democrat == 1 & runif(simN)<0.8, 6, 0)       # Latino
region2 <- ifelse(democrat == 1 & runif(simN)<0.7, 5, region1) # Europe
region3 <- ifelse(democrat == 1 & runif(simN)<0.3, 4, region2) # North America
region4 <- ifelse(democrat == 0 & runif(simN)<0.5, 3, region3) # Africa
region5 <- ifelse(democrat == 0 & runif(simN) <0.8, 2, region4) # Asia 
region <- ifelse(region5==0, 7, region5)                        # Middle East         

# check the variable 
summary(region)    # no NA
unique(region)     # unique values 
```


This variable is discrete, and thus I use the bar plot instead of histogram. 

```{r}
# visualization of frequency in barplot - for discrete variable
barplot(table(region), main = "Bar plot for RIs variable" ,
        xlab = "# of Regional Institutions", ylab = "Frequency", 
        ylim = c(0, 70), col = "orange")
```

**Regime Transition**

Finally, I create the regime transition dummy variable. This variable is theoretically related both to the regime type and the average duration until ratification. Historically, democratization happened more than transition into autocracy. If countries change their regime, their trend of ratification process is expected not to be too fast or too late. 

```{r}
# creating a transition dummy variable 
set.seed(7272)
transit1 <- ifelse(democrat == 1 & runif(simN)<0.3, 1, NA)       # 30% democrat transitined
transit2 <- ifelse(democrat == 0 & runif(simN)<0.1, 1, transit1) # 10% autocrat transitioned
transit <- ifelse(is.na(transit2)==T, 0, 1)      # non-transitioned country

# check the created variable 
summary(transit)    # no NA
unique(transit)     # unique values
```


This variable is discrete variable, and thus I use the bar plot instead of histogram. 


```{r}
# visualization of frequency in barplot - for discrete variable
transit_name <- ifelse(transit == 1, "YES", "NO")
barplot(table(transit_name), main = "Bar plot of regime transition variable", 
        xlab = "Experience of Regime Transition", ylab = "Frequency", 
        col = "tomato")
```



**Average Duration**

Finally, I simulate values of the outcome variable, which is continuous and normally distributed and produced by the independent variables above. As I discussed, the possible values the outcome variable take is from 0 to 74. According to the theoretical expectation, the systematic component of the model is specified as follows: 

$$
\mbox{Average Duration}_i \sim N(\mu_i, \sigma)
$$
$$
\mu_i = \alpha + \beta_1 X_{regime} + \beta_2 X_{RI} + \beta_3 X_{transition} 
$$

```{r}
set.seed(7272)                          # set seed

a <- 37       # intercept
b.d <- 5      # coefficient of democracy (regime type)
b.r <- 1.4    # coefficient of RIs
b.t <- -2     # coefficient of regime transition
sigma <- 4    # homoskedastic standard deviation
```

After storing the simulated values of error and coefficients, I first check whether the simulation worked as I supposed. I checked the mean of simulated results and confirmed whether there is any value violatinglower and upper limits of this variable. Here, I could successfully create the acceptable values for the duration variable. 
```{r}
# data generating process
set.seed(7272)# set seed
duration <- rnorm(
  n = simN, 
  mean = a + b.d*democrat + b.r*region + b.t*transit, 
  sd = sigma)

# checking the results of simulation
mean(duration)                       # it should be around 37
unique(ifelse(duration > 0, 0, 1))   # returns 1 if violating of the lower limit
unique(ifelse(duration < 74, 0, 1))  # returns 1 if violating of the upper limit

# histogram
hist(duration, breaks = 25,  xlim = c(0,74), ylim = c(0,20),
     col = "lightblue", xlab = "Average duration until ratification", 
     main = paste("Histogram of average duration" ))

# fixing the range
hist(duration, breaks = 25,  xlim = c(25,65), ylim = c(0,20),
     col = "lightblue",xlab = "Average duration until ratification", 
     main = paste("Histogram of average duration" ))
```




```{r, results='asis', message=FALSE, warning=FALSE}
id <- rep(1:simN)  # creating id
sim.data <- data.frame(duration,  democrat, region, transit, id)

# check the data
library("xtable")
xtable(head(sim.data[,2:5]))

# creating table for summary statistics
library("stargazer")
stargazer(sim.data, type = "latex", title = "Summary Statistics of Simulated Data",
          summary.stat = c("n", "mean", "sd", "min", "max"))
```






```{r}
# Correlation between the average duration and democracy
rho <- cor(duration, democrat)
rho
```

Since now I got the dataframe which include both the outcome variable and the key independent variable, the following codes produce the histogram by grouping regime types. There is `lattice` package which is an extentended version of the base plot, and it is useful to use `lattice::histogram()` for this purpose. 

```{r}
library("RColorBrewer")
myColours <- brewer.pal(5,"Blues")

my.settings <- list(
  superpose.polygon=list(col=myColours[2:5], border="transparent"),
  strip.background=list(col=myColours[6]),
  strip.border=list(col="black")
)

library('lattice')
sim.data$democrat_name <- factor(sim.data$democrat,
                                 labels = paste(c("Autocracy", "Democracy")))
histogram(~ duration | democrat_name, data = sim.data, scales=list(alternating=1),    
          auto.key=list(space="top", columns=4, 
          points=FALSE, rectangles=TRUE,
          title="District", cex.title=1),
          col = "#443A83FF", 
          main = paste("Histograms of average duration grouping by regime"),
          xlab = "Regime Type", ylab = "Frequency",
          par.settings = my.settings)
```
According to this output, the data of autocratic regime are smaller, converting around 42, while the data points of democracy consentrate around 47. Seemingly, it is along with the setting of the data generating process, assigning the longer average duration for democratic countries.


## Normal-Linear Regression Model

Using this simulated dataset, now I examine the relationship between the average duration and the regime type. The model is normal-linear-homoskedastic.  
 
```{r}
model1 <- lm(duration ~ democrat + region + transit, data=sim.data)
summary(model1)
```
According to the estimated coefficients, it reports close values which I specified before. As I theoretically expected and setted, democratic countries tend to take more time for ratification process in general, and its effect size is almost 5 years. The result is statistically significant. For the region variable, also the result supports as well. Substantively, if the number of regional institutions increase by 1, it makes ratification process be in delay by around one and half years. 


To report in \LaTeX style, `stargazer()` is also useful to report the regression output.  
```{r, results='asis'}
stargazer(model1,
          digits = 2, digits.extra = 0, # align = TRUE,
          #star.cutoffs = NA, omit.table.layout = "n", ## this line is important!
          keep.stat = c("n", "adj.rsq", "f"), df = FALSE,
          covariate.labels = c("Regime Type", "Number of RIs", "Regime Transition"),
          dep.var.caption = "Dependent variable",
          dep.var.labels = "The Average Duration",
          title = "Results of Linear Regressions",
          type = "latex")
```



### Predicted Values on Plots
To visualize predicted values for typical cases, first we need to extract typical case from the simulated dataset, grap the estimated coefficients according to the results of regression, to substitute them to the linear aggregator function. I determine median as the typical case for each variable. For the extraction of coefficients, I used `coef() function` by specifying the variable. 

```{r}
# typical case
m_democ <- median(sim.data[,2])  # regime type 
m_region <- median(sim.data[,3])  # RIs 
m_transit <- median(sim.data[,4])  # regime transition

# We can extract estimated parameters by using `coef()`
a_hat <- coef(model1)[1]  # intercept
b1_hat <- coef(model1)[2]  # regime type 
b2_hat <- coef(model1)[3]  # RIs
b3_hat <- coef(model1)[4]  # regime transition
```

Now I create empty vectors for the predicted values and possible ranges which independent variables can take. By using loop, I storing the predicted values by changing values of one independent variable and by fixing others at median. At the same time, it is useful to store the possible values of each independent variable. Then, by using stored vectors, I create a plot which has data points of predicted values and connects the points. 
```{r}
# create the empty vector  
# same as as.numeric()
pred_dur <- NA     # predicted average duration
democlim <- NA     # possible value of regime type 
regionlim <- NA    # possible value of RIs
transitlim <- NA   # possible value of regime transition 

# Regime type
for(i in 1:2) {
  pred_dur[i] <- a_hat + b1_hat* i + b2_hat*m_region + b3_hat*m_transit
  democlim[i] <- i
}

plot(democlim, pred_dur, ylab = "Predicted value of average duration", pch=16,
     xlab="Regime Type")
lines(pred_dur~democlim,type="l") 
title("Predicted Values")
```


This is for the number of regional institutions variable. 
```{r}
# # of Regional Institutions
pred_dur <- NA     # creating an empty vector again

for(i in 2:7) {
  pred_dur[i] <- a_hat + b1_hat*m_democ + b2_hat*i + b3_hat*m_transit
  regionlim[i] <- i
}

plot(regionlim, pred_dur, ylab = "Predicted value of average duration", pch=16,
     xlab="# of Regional Institutions")
lines(pred_dur~regionlim,type="l") 
title("Predicted Values")
```


The final one is about the experience of regime transition. 
```{r}
# Experience of regime transition
pred_dur <- NA      # creating an empty vector again
for(i in 1:2) {
  pred_dur[i] <- a_hat + b1_hat*m_democ + b2_hat*m_region + b3_hat*i
  transitlim[i] <- i
}

plot(transitlim, pred_dur, ylab = "Predicted value of average duration", pch=16,
     xlab="# of Regional Institutions")
lines(pred_dur~transitlim,type="l") 
title("Predicted Values")
```






```{r}
# checking the median as the tipical case
PredValue(model1, region, 2, 7, 1)
PredValue(model1, democrat, 0, 1, 1)
PredValue(model1, transit, 0, 1, 1)
```


## Agregated Level Analysis
Since this practice includes the use of aggregate level variable, I create the aggregate level. I already define the number of region level institutions, but here I consider the region as the aggregate level. 
```{r}
# creating region ID
sim.data$id <- NA
for (i in seq_along(sim.data$region)) {
  sim.data$id[i] <- sim.data$region[i] - 1
}

 # creating empty vectors
 # region level average duation, % of democ, % of transit 
 agg.duration<-c()
 agg.democ<-c()
 agg.transit<-c()
 temp<-c()
 agg.total<-c()
 
 # creating temporary vectors to make agg. variables
 rid  <- sim.data$id
 rdur <- sim.data$duration
 rdem <- sim.data$democrat
 rtra <- sim.data$transit

 #  loop to store aggregated level information
 for(i in 1:6) {   
   agg.total[i] <- length(rid[sim.data$id==i])
   
   # calculating arithmetic mean of average duration
   agg.duration[i] <- sum(rdur[sim.data$id==i])/length(rdur[sim.data$id==i])
   
   # % of democratic country in each region
   agg.democ[i] <- sum(rdem[sim.data$id==i])/length(rdem[sim.data$id==i])
   
   # % of states experienced regime transition
   agg.transit[i] <- sum(rtra[sim.data$id==i])/length(rtra[sim.data$id==i])
 }
 
mean(agg.duration)     # it should be around 37                   
# reporting 1 if violating the upper or lower limit
unique(ifelse(agg.duration > 0 | agg.duration < 74, 0, 1))   


mean(agg.democ)
# reporting 1 if violating the upper or lower limit
unique(ifelse(agg.democ >= 0 | agg.democ <= 1, 0, 1)) 


mean(agg.transit)
# unique value: 1 shows violation of the lower limit
unique(ifelse(agg.transit >= 0 | agg.transit <= 1, 0, 1))   
```
From now on, I'm going to creat a new dataset consists of region as a unit of analysis. 

```{r}
# creating region level data
regid <- 1:6

# the majority of regional members are democracy or not
d.democ <- ifelse(agg.democ > .5, 1, 0)
d.democ

# storing all variables into a data frame
agg.data <- data.frame(regid = regid, r.democ = agg.democ, 
                       r.transit = agg.transit, r.duration = agg.duration, 
                       d.democ)
stargazer(agg.data, type = "latex", title = "Summary Statistics of Aggregated Data",
          summary.stat = c("n", "mean", "sd", "min", "max"))

# agg.data
# write.table(agg.data, "data/sim_precinct.csv", sep=",", row.names=F) # Output the data
```


```{r}
 # Simple Analysis
model2 <- lm(r.duration ~ r.democ + r.transit, data=agg.data)
model3 <- lm(r.duration ~ d.democ + r.transit, data=agg.data)
summary(model2) # Compare with the individual level model
```


```{r, results='asis'}
stargazer(model2, model3,
          digits = 2, digits.extra = 0, # align = TRUE,
          star.cutoffs = NA, omit.table.layout = "n", ## this line is important!
          keep.stat = c("n", "adj.rsq", "f"), df = FALSE,
          covariate.labels = c("Regime Type", "Regime Transition"),
          dep.var.caption = "Dependent variable",
          dep.var.labels = "The Average Duration",
          title = "Results of Linear Regressions (Region Level Data)",
          type = "latex")

```



## Comments on Data Collection

The advantage of simulation was that I could imaginally create possible values and input and use them. However, in the data collection, I need to pay more attention to definition in the first place. For example, independence from the colonial governance or the former goverment has a special process to success the international law. Also, it is important whether we should exclude or include the case without ratification at this moment. Although I assumed that those countries are still in the ratification process, they never commit to the international agreement without any intentions. Therefore, substantively, I have to elaborate the proxy what I really want to capture, and technically, definition should be specified. 





\newpage

# Simulation for A Binary Outcome

**Instruction**: Repeat the same simulation for a binary random variable of your interest. Here use a Bernoulli-Logistic model.



## Introduction -- Research Question and Background

**Under what condistions do states participate the negotiation process of the international agreement?** Scholarly works have been focused on what types of countries ratify multilateral treaties. However, there is only limited works on examining the mechanism of the treaty creation. This is a quite importnat stage for potential participants, since they can bring their preferences at the bargaining table, regarding both the contents of treaty provision and the important treaty designes -- such as the enforcement mechanisms and punishment. 


## Domestic Political Institutions and Ratification Process

As I mentioned before, the domestic administrative process is the key element. My theoretical expectatin is that democratic countries take more time to ratify treaties. I am interested in how domestic political institutions have an influence on their duration until ratify treaties, comparing to non-democratic regime. There are two phases making ratification process delay in democratic countries. One is the legislative hurdle. Assuming office-seeking legislatures, it is possible that some of them disagree with treaties which can conflict with preferences of their supporters. Or, even if the legislatures do not disagree, they might want to prioritize discussions about domestic policies at the Congress and the Parliament. The other process required in democracies is the executive procedure. Where executive brunch have constraint on the decision making, it becomes more hard to pass potentional new laws related to treaties or to obtain approval for treaties. Comparing to this, in autocracy, decision making is done by a political lader and the small group of relevant actors. Also, leaders do not need to take accountability to citizens in terms of decisions they made and counsequences of the decisions. Accordingly, I expect that the general time to ratify takes more time in democracies, comparing to autocratic countris. 

Before getting in depth about details, I specify what are the "treaty" in this context. Although there are a number of treaty types, I am interested in international multirateral treaties, which are open for all the United Nations member countries. These treaties are differenciated by other treaties, such as bilateral treaties, since every state has the equal opportunity to participate. Regional treaties, for example, only focus on members of the reagion as potential ratifiers. Bilateral treaties are exclusive too. Considering those characteristics, the examination of  the UN treaties has an advantage to compare all UN members in terms of their overall ratifying practices. 

### Sample and Measurement

Based on the discussion above, the analytical unit is country, and all countries are the UN members. The total number of the UN members is 193. To understand the pattern, I measure it by taking a arithmetic mean of years until ratification for all treaties they follow (" _average duration_ ", hereafter), as the outcome variable. The first UN treaty became open in 1945. If states do not ratify a treaty yet, it is recognized as still being the ratification process, and the possible latest year is 2019. Therefore, the longest time to ratify treaty is 74 years (= 2019 - 1945). Since I calculate the arismetic mean, so the variable is continuous.

The key independent variable of interest is _regime type_. If countries are currently ruled in democratic political system, it is considered as democracy, otherwise autocracy. For the sake of the requrement of the question, I include the number of _regional institutions_ (RIs) as a control variable. This is because the development of RIs can embed members in the regional ties and cooperation based agreements, and peer pressure for ratification emerge. In addition, I include the _regime transition experience_ because it might affects the current ruling system and ratification process to some treaties which were done in different ways. 


$$
Y = \alpha + \beta_1 X_{regime} + \beta_2 X_{RI} + \beta_3 X_{transition} 
$$



## Simulation


### Preparation 

First, I clean up the environment.
```{r clean-up, results=FALSE}
rm(list=ls()) # rm() cleans up your R
gc();gc()     # gc() cleans up your memory
```


Here I simulate the model for the most ideal case, where the every data would be available. To fix the results for the pseudo-random number generation, I also set seed here. 
```{r simulation setup}
simN <- 193    # the number of total UN members 
```




**Regime Type**

For now, I start to create the independent variables based on substantive knowledge. First, I create the regime variable. 

```{r regime type}
set.seed(7272)
democrat <- rbinom(simN, size = 1, prob = .7)
```



```{r}
summary(democrat)
unique(democrat)

# visualization of frequency in barplot - for discrete variable
democrat_name <- ifelse(democrat == 1, "Democracy", "Autocracy")
barplot(table(democrat_name), main = "Bar plot of regime variable", 
        xlab = "Regime type", ylab = "Frequency", ylim=c(0,140), col = "maroon")
```


**Number of Regional Institutions**

Next, I create the variable of RIs. To deffirenciate the region based on this variable, I set the condition based on the general observation of treaty ratification pattern across regions. 

```{r, results='asis'}
# creating an aggregate level variable - regional institutions
set.seed(7272)
region1 <- ifelse(democrat == 1 & runif(simN)<0.8, 6, 0)       # Latino
region2 <- ifelse(democrat == 1 & runif(simN)<0.7, 5, region1) # Europe
region3 <- ifelse(democrat == 1 & runif(simN)<0.3, 4, region2) # North America
region4 <- ifelse(democrat == 0 & runif(simN)<0.5, 3, region3) # Africa
region5 <- ifelse(democrat == 0 & runif(simN) <0.8, 2, region4) # Asia 
region <- ifelse(region5==0, 7, region5)                        # Middle East         

# check the variable 
summary(region)    # no NA
unique(region)     # unique values 
```


This variable is discrete, and thus I use the bar plot instead of histogram. 

```{r}
# visualization of frequency in barplot - for discrete variable
barplot(table(region), main = "Bar plot for RIs variable" ,
        xlab = "# of Regional Institutions", ylab = "Frequency", 
        ylim = c(0, 70), col = "orange")
```

**Regime Transition**

Finally, I create the regime transition dummy variable. This variable is theoretically related both to the regime type and the average duration until ratification. Historically, democratization happened more than transition into autocracy. If countries change their regime, their trend of ratification process is expected not to be too fast or too late. 

```{r}
# creating a transition dummy variable 
set.seed(7272)
transit1 <- ifelse(democrat == 1 & runif(simN)<0.3, 1, NA)       # 30% democrat transitined
transit2 <- ifelse(democrat == 0 & runif(simN)<0.1, 1, transit1) # 10% autocrat transitioned
transit <- ifelse(is.na(transit2)==T, 0, 1)      # non-transitioned country

# check the created variable 
summary(transit)    # no NA
unique(transit)     # unique values
```


This variable is discrete variable, and thus I use the bar plot instead of histogram. 


```{r}
# visualization of frequency in barplot - for discrete variable
transit_name <- ifelse(transit == 1, "YES", "NO")
barplot(table(transit_name), main = "Bar plot of regime transition variable", 
        xlab = "Experience of Regime Transition", ylab = "Frequency", 
        col = "tomato")
```



**Average Duration**

Finally, I simulate values of the outcome variable, which is continuous and normally distributed and produced by the independent variables above. As I discussed, the possible values the outcome variable take is from 0 to 74. According to the theoretical expectation, the systematic component of the model is specified as follows: 

$$
\mbox{Average Duration}_i \sim N(\mu_i, \sigma)
$$
$$
\mu_i = \alpha + \beta_1 X_{regime} + \beta_2 X_{RI} + \beta_3 X_{transition} 
$$

```{r}
set.seed(7272)                          # set seed

a <- 37       # intercept
b.d <- 5      # coefficient of democracy (regime type)
b.r <- 1.4    # coefficient of RIs
b.t <- -2     # coefficient of regime transition
sigma <- 4    # homoskedastic standard deviation
```

After storing the simulated values of error and coefficients, I first check whether the simulation worked as I supposed. I checked the mean of simulated results and confirmed whether there is any value violatinglower and upper limits of this variable. Here, I could successfully create the acceptable values for the duration variable. 
```{r}
# data generating process
set.seed(7272)# set seed
duration <- rnorm(
  n = simN, 
  mean = a + b.d*democrat + b.r*region + b.t*transit, 
  sd = sigma)

# checking the results of simulation
mean(duration)                       # it should be around 37
unique(ifelse(duration > 0, 0, 1))   # returns 1 if violating of the lower limit
unique(ifelse(duration < 74, 0, 1))  # returns 1 if violating of the upper limit

# histogram
hist(duration, breaks = 25,  xlim = c(0,74), ylim = c(0,20),
     col = "lightblue", xlab = "Average duration until ratification", 
     main = paste("Histogram of average duration" ))

# fixing the range
hist(duration, breaks = 25,  xlim = c(25,65), ylim = c(0,20),
     col = "lightblue",xlab = "Average duration until ratification", 
     main = paste("Histogram of average duration" ))
```




```{r, results='asis', message=FALSE, warning=FALSE}
id <- rep(1:simN)  # creating id
sim.data <- data.frame(duration,  democrat, region, transit, id)

# check the data
library("xtable")
xtable(head(sim.data[,2:5]))

# creating table for summary statistics
library("stargazer")
stargazer(sim.data, type = "latex", title = "Summary Statistics of Simulated Data",
          summary.stat = c("n", "mean", "sd", "min", "max"))
```






```{r}
# Correlation between the average duration and democracy
rho <- cor(duration, democrat)
rho
```

Since now I got the dataframe which include both the outcome variable and the key independent variable, the following codes produce the histogram by grouping regime types. There is `lattice` package which is an extentended version of the base plot, and it is useful to use `lattice::histogram()` for this purpose. 

```{r}
library("RColorBrewer")
myColours <- brewer.pal(5,"Blues")

my.settings <- list(
  superpose.polygon=list(col=myColours[2:5], border="transparent"),
  strip.background=list(col=myColours[6]),
  strip.border=list(col="black")
)

library('lattice')
sim.data$democrat_name <- factor(sim.data$democrat,
                                 labels = paste(c("Autocracy", "Democracy")))
histogram(~ duration | democrat_name, data = sim.data, scales=list(alternating=1),    
          auto.key=list(space="top", columns=4, 
          points=FALSE, rectangles=TRUE,
          title="District", cex.title=1),
          col = "#443A83FF", 
          main = paste("Histograms of average duration grouping by regime"),
          xlab = "Regime Type", ylab = "Frequency",
          par.settings = my.settings)
```
According to this output, the data of autocratic regime are smaller, converting around 42, while the data points of democracy consentrate around 47. Seemingly, it is along with the setting of the data generating process, assigning the longer average duration for democratic countries.


## Bernoulli-Logistic Regression Model

Using this simulated dataset, now I examine the relationship between the average duration and the regime type. The model is normal-linear-homoskedastic.  
 
```{r}
model1 <- lm(duration ~ democrat + region + transit, data=sim.data)
summary(model1)
```
According to the estimated coefficients, it reports close values which I specified before. As I theoretically expected and setted, democratic countries tend to take more time for ratification process in general, and its effect size is almost 5 years. The result is statistically significant. For the region variable, also the result supports as well. Substantively, if the number of regional institutions increase by 1, it makes ratification process be in delay by around one and half years. 


To report in \LaTeX style, `stargazer()` is also useful to report the regression output.  
```{r, results='asis'}
stargazer(model1,
          digits = 2, digits.extra = 0, # align = TRUE,
          #star.cutoffs = NA, omit.table.layout = "n", ## this line is important!
          keep.stat = c("n", "adj.rsq", "f"), df = FALSE,
          covariate.labels = c("Regime Type", "Number of RIs", "Regime Transition"),
          dep.var.caption = "Dependent variable",
          dep.var.labels = "The Average Duration",
          title = "Results of Linear Regressions",
          type = "latex")
```



### Predicted Values on Plots
To visualize predicted values for typical cases, first we need to extract typical case from the simulated dataset, grap the estimated coefficients according to the results of regression, to substitute them to the linear aggregator function. I determine median as the typical case for each variable. For the extraction of coefficients, I used `coef() function` by specifying the variable. 

```{r}
# typical case
m_democ <- median(sim.data[,2])  # regime type 
m_region <- median(sim.data[,3])  # RIs 
m_transit <- median(sim.data[,4])  # regime transition

# We can extract estimated parameters by using `coef()`
a_hat <- coef(model1)[1]  # intercept
b1_hat <- coef(model1)[2]  # regime type 
b2_hat <- coef(model1)[3]  # RIs
b3_hat <- coef(model1)[4]  # regime transition
```

Now I create empty vectors for the predicted values and possible ranges which independent variables can take. By using loop, I storing the predicted values by changing values of one independent variable and by fixing others at median. At the same time, it is useful to store the possible values of each independent variable. Then, by using stored vectors, I create a plot which has data points of predicted values and connects the points. 
```{r}
# create the empty vector  
# same as as.numeric()
pred_dur <- NA     # predicted average duration
democlim <- NA     # possible value of regime type 
regionlim <- NA    # possible value of RIs
transitlim <- NA   # possible value of regime transition 

# Regime type
for(i in 1:2) {
  pred_dur[i] <- a_hat + b1_hat* i + b2_hat*m_region + b3_hat*m_transit
  democlim[i] <- i
}

plot(democlim, pred_dur, ylab = "Predicted value of average duration", pch=16,
     xlab="Regime Type")
lines(pred_dur~democlim,type="l") 
title("Predicted Values")
```


This is for the number of regional institutions variable. 
```{r}
# # of Regional Institutions
pred_dur <- NA     # creating an empty vector again

for(i in 2:7) {
  pred_dur[i] <- a_hat + b1_hat*m_democ + b2_hat*i + b3_hat*m_transit
  regionlim[i] <- i
}

plot(regionlim, pred_dur, ylab = "Predicted value of average duration", pch=16,
     xlab="# of Regional Institutions")
lines(pred_dur~regionlim,type="l") 
title("Predicted Values")
```


The final one is about the experience of regime transition. 
```{r}
# Experience of regime transition
pred_dur <- NA      # creating an empty vector again
for(i in 1:2) {
  pred_dur[i] <- a_hat + b1_hat*m_democ + b2_hat*m_region + b3_hat*i
  transitlim[i] <- i
}

plot(transitlim, pred_dur, ylab = "Predicted value of average duration", pch=16,
     xlab="# of Regional Institutions")
lines(pred_dur~transitlim,type="l") 
title("Predicted Values")
```






```{r}
# checking the median as the tipical case
PredValue(model1, region, 2, 7, 1)
PredValue(model1, democrat, 0, 1, 1)
PredValue(model1, transit, 0, 1, 1)
```


## Agregated Level Analysis
Since this practice includes the use of aggregate level variable, I create the aggregate level. I already define the number of region level institutions, but here I consider the region as the aggregate level. 
```{r}
# creating region ID
sim.data$id <- NA
for (i in seq_along(sim.data$region)) {
  sim.data$id[i] <- sim.data$region[i] - 1
}

 # creating empty vectors
 # region level average duation, % of democ, % of transit 
 agg.duration<-c()
 agg.democ<-c()
 agg.transit<-c()
 temp<-c()
 agg.total<-c()
 
 # creating temporary vectors to make agg. variables
 rid  <- sim.data$id
 rdur <- sim.data$duration
 rdem <- sim.data$democrat
 rtra <- sim.data$transit

 #  loop to store aggregated level information
 for(i in 1:6) {   
   agg.total[i] <- length(rid[sim.data$id==i])
   
   # calculating arithmetic mean of average duration
   agg.duration[i] <- sum(rdur[sim.data$id==i])/length(rdur[sim.data$id==i])
   
   # % of democratic country in each region
   agg.democ[i] <- sum(rdem[sim.data$id==i])/length(rdem[sim.data$id==i])
   
   # % of states experienced regime transition
   agg.transit[i] <- sum(rtra[sim.data$id==i])/length(rtra[sim.data$id==i])
 }
 
mean(agg.duration)     # it should be around 37                   
# reporting 1 if violating the upper or lower limit
unique(ifelse(agg.duration > 0 | agg.duration < 74, 0, 1))   


mean(agg.democ)
# reporting 1 if violating the upper or lower limit
unique(ifelse(agg.democ >= 0 | agg.democ <= 1, 0, 1)) 


mean(agg.transit)
# unique value: 1 shows violation of the lower limit
unique(ifelse(agg.transit >= 0 | agg.transit <= 1, 0, 1))   
```
From now on, I'm going to creat a new dataset consists of region as a unit of analysis. 

```{r}
# creating region level data
regid <- 1:6

# the majority of regional members are democracy or not
d.democ <- ifelse(agg.democ > .5, 1, 0)
d.democ

# storing all variables into a data frame
agg.data <- data.frame(regid = regid, r.democ = agg.democ, 
                       r.transit = agg.transit, r.duration = agg.duration, 
                       d.democ)
stargazer(agg.data, type = "latex", title = "Summary Statistics of Aggregated Data",
          summary.stat = c("n", "mean", "sd", "min", "max"))

# agg.data
# write.table(agg.data, "data/sim_precinct.csv", sep=",", row.names=F) # Output the data
```


```{r}
 # Simple Analysis
model2 <- lm(r.duration ~ r.democ + r.transit, data=agg.data)
model3 <- lm(r.duration ~ d.democ + r.transit, data=agg.data)
summary(model2) # Compare with the individual level model
```


```{r, results='asis'}
stargazer(model2, model3,
          digits = 2, digits.extra = 0, # align = TRUE,
          star.cutoffs = NA, omit.table.layout = "n", ## this line is important!
          keep.stat = c("n", "adj.rsq", "f"), df = FALSE,
          covariate.labels = c("Regime Type", "Regime Transition"),
          dep.var.caption = "Dependent variable",
          dep.var.labels = "The Average Duration",
          title = "Results of Linear Regressions (Region Level Data)",
          type = "latex")

```



## Comments on Data Collection

The advantage of simulation was that I could imaginally create possible values and input and use them. However, in the data collection, I need to pay more attention to definition in the first place. For example, independence from the colonial governance or the former goverment has a special process to success the international law. Also, it is important whether we should exclude or include the case without ratification at this moment. Although I assumed that those countries are still in the ratification process, they never commit to the international agreement without any intentions. Therefore, substantively, I have to elaborate the proxy what I really want to capture, and technically, definition should be specified. 



